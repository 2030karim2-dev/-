# خطة إصلاح نظام المرتجعات

## ملخص المشكلة

المستخدم يواجه مشكلتين:
1. **حقول الإدخال مقفلة**: لا يمكن كتابة أي نص في حقول الإدخال في شاشات مرتجعات المبيعات والمشتريات
2. **عدم عرض منتجات الفاتورة**: عند اختيار الفاتورة الأصلية، لا يتم عرض قائمة واضحة بالمنتجات

---

## تحليل السبب الجذري

### المشكلة الأولى: حقول الإدخال مقفلة

بعد تحليل الكود، لاحظت عدة نقاط可能导致 المشكلة:

1. ** Modal Component**: المكون الرئيسي للنوافذ يستخدم `enableFieldNavigation` بشكل افتراضي
2. **التركيز التلقائي**: يتم التركيز على أول حقل عند فتح النافذة
3. **التنسيق مع z-index**: قد يكون هناك تداخل في الطبقات يمنع التفاعل

### المشكلة الثانية: عدم عرض منتجات الفاتورة

- في نموذج مرتجعات المبيعات (`CreateReturnModal.tsx`): يتم عرض الأصناف عند اختيار الفاتورة
- في نموذج مرتجعات المشتريات (`CreatePurchaseReturnModal.tsx`): لا يوجد عرض لأصناف الفاتورة

---

## خطة الإصلاح

### المرحلة 1: إصلاح حقول الإدخال

1. فحص وإصلاح مشكلة z-index في حقول الإدخال
2. التأكد من أن معالجات الأحداث تعمل بشكل صحيح
3. إضافة تصحيح للأحداث إذا لزم الأمر

### المرحلة 2: إضافة عرض منتجات الفاتورة

1. تحسين عرض أصناف الفاتورة في مرتجعات المبيعات
2. إضافة نفس الوظيفة لمرتجعات المشتريات
3. تحسين تجربة المستخدم في الاختيار

---

## الملفات المطلوبة للتعديل

```
# ملفات التعديل
src/features/sales/components/Returns/CreateReturnModal.tsx
src/features/purchases/components/Returns/CreatePurchaseReturnModal.tsx
src/ui/base/Modal.tsx (إذا لزم الأمر)
```

---

## التنفيذ

سأنتقل الآن لوضع التنفيذ (Code Mode) لإصلاح这些问题.
