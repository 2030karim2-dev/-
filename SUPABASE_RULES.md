
# ๐ก๏ธ ุฏุณุชูุฑ ุงูุงุฑุชุจุงุท ูุน Supabase (Single Source of Truth)

ูุฐู ุงููุซููุฉ ุชุญุฏุฏ ุงูููุงุนุฏ ุงูุตุงุฑูุฉ ูุงูููุฒูุฉ ูุฃู ุนูููุฉ ุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูุธุงู ุงูุฒูุฑุงุก. ุฃู ุฎุฑูุฌ ุนู ูุฐู ุงูููุงุนุฏ ูุนุชุจุฑ "ุฏูู ุชููู" ูุฌุจ ุฅุตูุงุญู ููุฑุงู.

---

## 1. ุงููุตุฏุฑ ุงููุญูุฏ ููุญูููุฉ (The Single Source of Truth)

*   **ุงูุจูุงูุงุช (Data):** ูุงุนุฏุฉ ุจูุงูุงุช **PostgreSQL** ุงููุณุชุถุงูุฉ ุนูู Supabase ูู ุงููุตุฏุฑ ุงููุญูุฏ ูุงูุญุตุฑู ููุจูุงูุงุช.
*   **ุญุงูุฉ ุงููุงุฌูุฉ (UI State):** ููุชุจุฉ **TanStack Query (React Query)** ูู ุงููุตุฏุฑ ุงููุญูุฏ ูุญุงูุฉ ุงูุฎุงุฏู (Server State) ุฏุงุฎู ุงูุชุทุจูู.
    *   ๐ซ **ููููุน** ุชุฎุฒูู ุจูุงูุงุช ูุงุฏูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู `useState` ุฃู `Redux/Zustand` ุฅูุง ููุถุฑูุฑุฉ ุงููุตูู (ูุซู ุงูููุงุฐุฌ ุงููุคูุชุฉ).
    *   โ **ูุฌุจ** ุงุณุชุฎุฏุงู `useQuery` ูุฌูุจ ุงูุจูุงูุงุช ู `useMutation` ููุชุนุฏูู.

---

## 2. ููุงุนุฏ ุงูุงุชุตุงู ูุงูุนููู (Client Rules)

*   **ูุซูู ูุงุญุฏ ููุท (Singleton):** ูุฌุจ ุงุณุชูุฑุงุฏ ุนููู `supabase` ุญุตุฑุงู ูู ุงููุณุงุฑ:
    `src/lib/supabaseClient.ts`
    ๐ซ **ููููุน** ุงุณุชุฎุฏุงู `createClient` ูู ุฃู ููู ุขุฎุฑ.
*   **ุงูุฃููุงุน ุงูุตุงุฑูุฉ (Strict Typing):** ูุฌุจ ุญูู `Database` Types ุนูุฏ ุชููุฆุฉ ุงูุนููู ูุถูุงู ุฃู ูู ุงุณุชุนูุงู (Query) ุฎุงุถุน ููุชุญูู ูู ุงูููุน (Type-Checked).

---

## 3. ููุงุนุฏ ุฌูุจ ุงูุจูุงูุงุช (Fetching Regulations)

*   **ุงูุทุจูุงุช (Layers):** ูููุน ุงุณุชุฏุนุงุก `supabase` ูุจุงุดุฑุฉ ุฏุงุฎู ููููุงุช React (Components).
    *   โ ุงููุณุงุฑ ุงูุตุญูุญ: `Component` -> `Hook` -> `Service` -> `API` -> `Supabase`.
*   **ุงูุชุณููุฉ (Naming):** ูุฌุจ ุฃู ุชุทุงุจู ุฃุณูุงุก ุงูุญููู ูู ูุงุฌูุงุช TypeScript (Interfaces) ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Snake_case ูู ุงููุงุนุฏุฉ -> CamelCase ูู ุงูุชุทุจูู ุนุจุฑ Mapping Layer ูู ุงูู Service).

---

## 4. ููุงุนุฏ ุงูุชุนุฏูู ูุงููุชุงุจุฉ (Mutation Regulations)

*   **ุงูุฐุฑูุฉ (Atomicity):** ุงูุนูููุงุช ุงูุชู ุชุชุทูุจ ุชุนุฏูู ุฃูุซุฑ ูู ุฌุฏูู (ูุซู: ุฅูุดุงุก ูุงุชูุฑุฉ + ุฎุตู ูุฎุฒูู + ููุฏ ูุญุงุณุจู) **ูุฌุจ** ุฃู ุชููุฐ ุนุจุฑ:
    1.  **Database Function (RPC):** ููู ุงูุฎูุงุฑ ุงูุฃูุถู ูุงูุฃูุซุฑ ุฃูุงูุงู.
    2.  **Supabase Edge Function:** ููุฎุฒูุงุฑุฒููุงุช ุงููุนูุฏุฉ.
    *   ๐ซ **ููููุน** ุชูููุฐ ุณูุณูุฉ ุงุณุชุฏุนุงุกุงุช `await` ูุชุชุงููุฉ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุนูููุงุช ูุชุฑุงุจุทุฉ (Transaction risk).
*   **ุงูุชุญุฏูุซ ุงูููุฑู (Optimistic Updates):** ุนูุฏ ุงูุชุนุฏููุ ูุฌุจ ุฅุจุทุงู ุงููุงุด (Invalidate Queries) ููุฑุงู ูุถูุงู ุธููุฑ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ.

---

## 5. ุงูุฃูุงู ูุงูุตูุงุญูุงุช (RLS & Security)

*   **ูุง ุชุตููุฉ ูู ุงููุงุฌูุฉ (No Frontend Filtering):** ุงูุฃูุงู ูุง ูุชุญูู ุจุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ. ูุฌุจ ุชูุนูู **Row Level Security (RLS)** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
*   **ุงูุดุฑูุฉ (Tenant Isolation):** ูู ุงุณุชุนูุงู **ูุฌุจ** ุฃู ูุญุชูู (ุชููุงุฆูุงู ุนุจุฑ RLS) ุนูู `company_id` ูุถูุงู ุนุฏู ุชุณุฑุจ ุจูุงูุงุช ุจูู ุงูุดุฑูุงุช.

---

## 6. ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก (Error Handling)

*   ูุง ุชูู ุฃุจุฏุงู ุจู `throw error` ูููุงุฆู ุงูุฎุงู ุงููุงุฏู ูู Supabase.
*   ูุฌุจ ุชูุฑูุฑ ุงูุฎุทุฃ ุนุจุฑ ุฏุงูุฉ `parseError` ูู `src/core/utils/errorUtils.ts` ูุชูุญูุฏ ุฑุณุงุฆู ุงูุฎุทุฃ ูููุณุชุฎุฏู.

---

## 7. ุงูุจูุฆุฉ (Environment)

*   ุงูููุงุชูุญ `VITE_SUPABASE_URL` ู `VITE_SUPABASE_ANON_KEY` ูู ุงููุญูุฏุฉ ุงููุณููุญ ุจูุง.
*   ูููุน ููุนุงู ุจุงุชุงู ูุชุงุจุฉ ุงูููุงุชูุญ (Hardcoded) ูู ุงูููุฏ ุงููุตุฏุฑู.

---

**ุงูุชูููุน:** ูุจูุฑ ูููุฏุณู ุงูุจุฑูุฌูุงุช - ูุธุงู ุงูุฒูุฑุงุก
